<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.15/css/jquery.dataTables.css"> <!-- Datatable -->

</head>
<body>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script> <!-- jquery -->
<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.15/js/jquery.dataTables.js"></script> <!-- Datatable -->
<script src="https://cdn.datatables.net/plug-ins/1.10.15/api/row().show().js"></script> <!-- Datatable -->
<link href="http://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">  <!-- font -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.js"></script> <!-- Chart js -->


<!-- Logo and Definition /////////////////////////////////////////////////// -->

{% if company_infos[1] %}
<div id="logo">
    <img src={{ company_infos[1] }}>
</div>
{% endif %}
{% if company_infos[0] %}
<div id="definition">
    {{ company_infos[0] }}
</div>
{% endif %}
<div id="news-publish"> ************</div>
<div id="news-title"> ********</div>
<div id="news-desc"> ********</div>
<div id="news-content"> ********</div>
<div id="news-url"> ********</div>

<!-- rating, ranking /////////////////////////////////////////////////////// -->

{% if job_listings %}
<p> Employees' Rating : {{ job_listings[0]["Rating"]}} </p>
{% endif %}

{% if ranking %}
<p> Google trends movement growth is {{ interest_growth }}%, ranking is {{ ranking }} of {{ industry_num }} in {{ industry_name }} sector. (during past 5 years) </p>
{% endif %}

<!-- Salary table ////////////////////////////////////////////////////////// -->

<table id ="salary-table" class="display table table-striped table-bordered" data-company-name="{{ company_name }}">
    <thead>
        <tr>
            <th>Date</th>
            <th>Job Title</th>
            <th data-class-name="priority">Salary</th>
            <th>Location</th>
        </tr>
    </thead>
    <tbody>
        {% for salary in salary_query %}
        <tr>
            <td>{{ salary.date.strftime("%b-%d-%Y") }} </td>
            <td>{{ salary.job_title.title() }}</td> 
            <td>{{ "${:,}".format(salary.salary) }}</td> 
            <td>{{ salary.location.title() }} </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Using DataTable for each table //////////////////////////////////////// -->

<script type="text/javascript">
$(document).ready(function() {
    $('table.display').DataTable();
} );
</script>


<!-- Glassdoor job listing table /////////////////////////////////////////// -->


<table class="display table table-striped table-bordered">
<thead>
    <tr>
        <th>Job Title</th>
        <th>Location</th>
        <th>Glassdoor Estimated Salary</th>
        <th>Url</th>
    </tr>
</thead>
<tbody>
    {% for job in job_listings %}
    <tr>
        <td>{{ job["Name"] }} </td>
        <td>{{ job["City"] }}</td> 
        <td>{{ job["Salary"] }}</td> 
        <td><a href="{{ job["Url"] }}" target="_blank"> Click here </a></td>
    </tr>
    {% endfor %}
</tbody>
</table>   

<!-- Google trends interest chart ////////////////////////////////////////// -->

<canvas data-chart='{{ interest_chart|tojson }}' id="myChart"></canvas>
<script>
const ctx = document.getElementById("myChart").getContext('2d');
const myChart = new Chart.Line(ctx, {
    data: {
        labels: $("#myChart").data("chart").label1,
        datasets: [{
            label: $("#salary-table").data("company-name"),
            data: $("#myChart").data("chart").label2,
            backgroundColor: "rgba(255, 99, 132, 0.2)",
            borderColor: "rgba(255, 99, 132, 1)",
            borderWidth: 1,
            pointHoverBackgroundColor : "rgba(255, 99, 132, 1)",
            pointHoverBorderColor : "rgba(255, 99, 132, 0.2)",
            pointHoverBorderWidth : 2,
            pointHitRadius : 10,
        }]
    },
    options: {
        scales: {
            xAxes: [{
                      display: true,
                      ticks: {
                          callback: function(dataLabel, index) {
                              return index % 2 === 0 ? dataLabel : '';
                          }
                      }
            }],
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }],
        }
    }
});

</script>

<!-- News generator by click event ///////////////////////////////////////// -->

<script type="text/javascript">

document.getElementById("myChart").onclick = function(evt){
            const activePoints2 = myChart.getElementsAtEvent(evt);
            const firstPoint2 = activePoints2[0];
            const label = myChart.data.labels[firstPoint2._index];
            const value = myChart.data.datasets[firstPoint2._datasetIndex].data[firstPoint2._index];
            alert(label + ": " + value);
            let company_data = { "company_name" : $("#salary-table").data("company-name"), "from" : label};

            const url = "news.json";

            $.get(url, company_data, (response) => {
                $('#news-publish').html(response.publishedAt);
                $('#news-desc').html(response.description);
                $('#news-title').html(response.title);
                $('#news-content').html(response.content);
                $('#news-url').html(response.url);
                console.log(response);
    });

        };


</script>



</body>
</html>

